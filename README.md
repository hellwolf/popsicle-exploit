# Motivation

Following the tutorials from Certora about [Popsicle Finance
Exploit](https://github.com/Certora/Tutorials/blob/master/08.Lesson_WorkingWithInvariants/WritingRules/PopsicleFinance/),
it is an interesting exercise to try out if we could reproduce the same exploit using
[dapptool](https://github.com/dapphub/dapptools/).

# How To Use

`Popsicle.transfer` is the function of culprit. The correct logic should `_updateReward` for both sender and receiver, otherwise it would not hold the "rewardInvariance". Read Certora tutorial for more explanation.

`PopsicleTest` has the test cases for demonstrating the exploit:

* `test_rewardInvariance_simple`: a simple sequence that doesn't trigger the exploit.
* `testFail_rewardInvariance_exploit`: a specific exploit sequence.
* `test_rewardInvariance_complex`: a fuzzing testing that randomly generate a sequence of operations that disocver the bug.

Conclusion: it's lucky with the fuzzing randomized sequence operations, because the invariance is so obvious, and even a bit more testing could have protected it. But it demonstrate a specific technique of fuzzing.

# Next Steps

Make some of the test symbolic executed test, currently HEVM fails with:

```
hevm: unexpected symbolic argument
CallStack (from HasCallStack):
  error, called at src/EVM/Symbolic.hs:42:14 in hevm-0.49.0-LKV6XlfnTklJ23RljYHQxH:EVM.Symbolic
```